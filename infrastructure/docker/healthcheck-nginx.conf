events {
    worker_connections 1024;
}

http {
    upstream postgres {
        server postgres:5432;
    }

    upstream mongodb {
        server mongodb:27017;
    }

    upstream qdrant {
        server qdrant:6333;
    }

    upstream kafka {
        server kafka:9092;
    }

    upstream ollama {
        server ollama:11434;
    }

    upstream mock-api {
        server mock-api:8888;
    }

    upstream mcp-server {
        server mcp-server:8765;
    }

    server {
        listen 80;

        location /health {
            default_type application/json;
            return 200 '{"status": "healthy", "services": ["postgres", "mongodb", "qdrant", "kafka", "ollama", "mock-api", "mcp-server"]}';
        }

        location /health/postgres {
            proxy_pass http://postgres/;
            proxy_connect_timeout 1s;
            proxy_read_timeout 1s;
        }

        location /health/qdrant {
            proxy_pass http://qdrant/health;
            proxy_connect_timeout 1s;
            proxy_read_timeout 1s;
        }

        location /health/ollama {
            proxy_pass http://ollama/api/version;
            proxy_connect_timeout 1s;
            proxy_read_timeout 1s;
        }

        location /health/mock-api {
            proxy_pass http://mock-api/health;
            proxy_connect_timeout 1s;
            proxy_read_timeout 1s;
        }

        location /health/mcp {
            proxy_pass http://mcp-server/health;
            proxy_connect_timeout 1s;
            proxy_read_timeout 1s;
        }
    }
}
